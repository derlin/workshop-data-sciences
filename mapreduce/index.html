
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
        <meta name="author" content="Lucy Linder (DAPLAB)">
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.10.1">
    
    
      
        <title>MapReduce - Workshop data sciences</title>
      
    
    
      <script src="../assets/javascripts/modernizr-e826f8942a.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-a20f419c8e.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-23f75ab9c7.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../style.css">
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="blue" data-md-color-accent="orange">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Workshop data sciences" class="md-header-nav__button md-logo">
          
            <i class="md-icon md-icon--home"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            MapReduce
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="" data-md-lang-tokenizer="[\s\-]+">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <div class="md-nav__button md-logo">
      
        <i class="md-icon md-icon--home"></i>
      
    </div>
    Workshop data sciences
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../hdfs/" title="HDFS" class="md-nav__link">
      HDFS
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        MapReduce
      </label>
    
    <a href="./" title="MapReduce" class="md-nav__link md-nav__link--active">
      MapReduce
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mapreduce-framework" title="MapReduce Framework" class="md-nav__link">
    MapReduce Framework
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mapreduce-phases" title="MapReduce Phases" class="md-nav__link">
    MapReduce Phases
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coding-with-mapreduce" title="Coding with MapReduce" class="md-nav__link">
    Coding with MapReduce
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-types-and-formats" title="Data Types and Formats" class="md-nav__link">
    Data Types and Formats
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lets-examine-our-first-mapreduce-program" title="Let’s examine our first MapReduce program" class="md-nav__link">
    Let’s examine our first MapReduce program
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-program" title="Running the program" class="md-nav__link">
    Running the program
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-tips" title="Implementation Tips" class="md-nav__link">
    Implementation Tips
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bigrams-count" title="Bigrams count" class="md-nav__link">
    Bigrams count
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../hive/" title="Hive" class="md-nav__link">
      Hive
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../zeppelin/" title="Zeppelin/Spark SQL" class="md-nav__link">
      Zeppelin/Spark SQL
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../spark/" title="LSA with Spark ML" class="md-nav__link">
      LSA with Spark ML
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mapreduce-framework" title="MapReduce Framework" class="md-nav__link">
    MapReduce Framework
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mapreduce-phases" title="MapReduce Phases" class="md-nav__link">
    MapReduce Phases
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coding-with-mapreduce" title="Coding with MapReduce" class="md-nav__link">
    Coding with MapReduce
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-types-and-formats" title="Data Types and Formats" class="md-nav__link">
    Data Types and Formats
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lets-examine-our-first-mapreduce-program" title="Let’s examine our first MapReduce program" class="md-nav__link">
    Let’s examine our first MapReduce program
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-program" title="Running the program" class="md-nav__link">
    Running the program
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-tips" title="Implementation Tips" class="md-nav__link">
    Implementation Tips
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bigrams-count" title="Bigrams count" class="md-nav__link">
    Bigrams count
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>MapReduce</h1>
                
                <p>MapReduce is a programming model for distributed data processing across multiple nodes. The programs are designed to compute large volumes of data in a parallel fashion. MapReduce works by breaking the processing into two main phases: Map phase and Reduce phase.</p>
<p>MapReduce execution framework allows the following:</p>
<ul>
<li>Automatic parallelization and distribution</li>
<li>Fault tolerance</li>
<li>Abstraction for programmers</li>
</ul>
<h2 id="mapreduce-framework">MapReduce Framework</h2>
<p><img alt="Mapreduce Framework" src="../resources/mapreduce_framework.png" /></p>
<h2 id="mapreduce-phases">MapReduce Phases</h2>
<p><strong>Map phase</strong></p>
<ul>
<li>Map phase is usually for filtering or transforming data. Each mapper performs a user-defined operation on a single HDFS block</li>
<li>Map tasks run on the node where the data block is stored</li>
<li>Input: key/value pair</li>
<li>Output: A list of zero or more key value/pairs</li>
</ul>
<p><strong>Partition - Shuffle and sort phase</strong></p>
<ul>
<li>Partitioner: Determines which partition a given (key,value) pair will go to</li>
<li>Shuffling: Moving map outputs to the reducers</li>
<li>Sorting: The set of intermediate keys on a single node is sorted before passing to the reducer</li>
</ul>
<p><strong>Reduce phase</strong></p>
<ul>
<li>Read all results for each key and performs a user-defined operation, for example: aggregations</li>
<li>The Reducer outputs zero or more final key/value pairs to the HDFS</li>
</ul>
<h2 id="coding-with-mapreduce">Coding with MapReduce</h2>
<h3 id="data-types-and-formats">Data Types and Formats</h3>
<ul>
<li>Keys and values are java objects</li>
<li>Writable interface for serialization</li>
<li>Values implement Writable interface</li>
<li>Keys implement WritableComparable interface</li>
<li>IntWritable – int</li>
<li>LongWritable – Long</li>
<li>FloatWritable – Float</li>
<li>DoubleWritable - Double</li>
<li>Text – String values</li>
</ul>
<h3 id="lets-examine-our-first-mapreduce-program">Let’s examine our first MapReduce program</h3>
<p>A typical MapReduce program consists of three main parts: Driver, Mapper and Reducer code.</p>
<p><strong>Driver Code</strong></p>
<ul>
<li>Contains Job configuration and submission details</li>
<li>Configurations not explicitly set in your driver code will be read from your Hadoop configuration files (/etc/hadoop/conf)</li>
</ul>
<p>Examine the below sample for Driver Code of word count example:</p>
<p><div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">Configuration</span> <span class="n">conf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Configuration</span><span class="o">();</span>
    <span class="n">Job</span> <span class="n">job</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Job</span><span class="o">(</span><span class="n">conf</span><span class="o">,</span><span class="s">&quot;word count&quot;</span><span class="o">);</span>

    <span class="n">job</span><span class="o">.</span><span class="na">setInputFormatClass</span><span class="o">(</span><span class="n">TextInputFormat</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">job</span><span class="o">.</span><span class="na">setJarByClass</span><span class="o">(</span><span class="n">WordCount</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="n">job</span><span class="o">.</span><span class="na">setMapperClass</span><span class="o">(</span><span class="n">WCMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">job</span><span class="o">.</span><span class="na">setReducerClass</span><span class="o">(</span><span class="n">WCReducer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="n">job</span><span class="o">.</span><span class="na">setMapOutputKeyClass</span><span class="o">(</span><span class="n">Text</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">job</span><span class="o">.</span><span class="na">setMapOutputValueClass</span><span class="o">(</span><span class="n">IntWritable</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">job</span><span class="o">.</span><span class="na">setOutputKeyClass</span><span class="o">(</span><span class="n">Text</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">job</span><span class="o">.</span><span class="na">setOutputValueClass</span><span class="o">(</span><span class="n">IntWritable</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="n">job</span><span class="o">.</span><span class="na">setOutputFormatClass</span><span class="o">(</span><span class="n">TextOutputFormat</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="n">FileInputFormat</span><span class="o">.</span><span class="na">addInputPath</span><span class="o">(</span><span class="n">job</span><span class="o">,</span> <span class="k">new</span> <span class="n">Path</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]));</span>
    <span class="n">FileOutputFormat</span><span class="o">.</span><span class="na">setOutputPath</span><span class="o">(</span><span class="n">job</span><span class="o">,</span> <span class="k">new</span> <span class="n">Path</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]));</span>
    <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="n">job</span><span class="o">.</span><span class="na">waitForCompletion</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
<strong>Mapper Code</strong></p>
<ul>
<li>Extend Mapper base class</li>
<li>Override map()</li>
<li>Input: key/value</li>
<li>Output: key/value</li>
</ul>
<p>Sample for Map class for word count example:</p>
<p><div class="codehilite"><pre><span></span><span class="kd">static</span> <span class="kd">class</span> <span class="nc">WCMapper</span> <span class="kd">extends</span> <span class="n">Mapper</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">,</span> <span class="n">Text</span><span class="o">,</span> <span class="n">Text</span><span class="o">,</span> <span class="n">IntWritable</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">IntWritable</span> <span class="n">one</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntWritable</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="kd">private</span> <span class="n">Text</span> <span class="n">word</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Text</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">map</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">,</span> <span class="n">Text</span> <span class="n">value</span><span class="o">,</span> <span class="n">Context</span> <span class="n">context</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="n">StringTokenizer</span> <span class="n">itr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringTokenizer</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">itr</span><span class="o">.</span><span class="na">hasMoreTokens</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">word</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">itr</span><span class="o">.</span><span class="na">nextToken</span><span class="o">());</span>
            <span class="n">context</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">word</span><span class="o">,</span> <span class="n">one</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
<strong>Reducer Code</strong></p>
<ul>
<li>Extend Reducer base class</li>
<li>Override reduce()</li>
<li>Input: key/collection of values</li>
<li>Output: key/value</li>
</ul>
<p>Sample for Reduce class for word count example:</p>
<div class="codehilite"><pre><span></span><span class="kd">static</span> <span class="kd">class</span> <span class="nc">WCReducer</span> <span class="kd">extends</span> <span class="n">Reducer</span><span class="o">&lt;</span><span class="n">Text</span><span class="o">,</span> <span class="n">IntWritable</span><span class="o">,</span> <span class="n">Text</span><span class="o">,</span> <span class="n">IntWritable</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">IntWritable</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntWritable</span><span class="o">();</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">reduce</span><span class="o">(</span><span class="n">Text</span> <span class="n">key</span><span class="o">,</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">IntWritable</span><span class="o">&gt;</span> <span class="n">values</span><span class="o">,</span> <span class="n">Context</span> <span class="n">context</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">IntWritable</span> <span class="n">value</span> <span class="o">:</span> <span class="n">values</span><span class="o">)</span>
            <span class="n">sum</span> <span class="o">+=</span> <span class="n">value</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
        <span class="n">result</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">sum</span><span class="o">);</span>
        <span class="n">context</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<h3 id="running-the-program">Running the program</h3>
<ul>
<li>Download <a href="../resources/bible_shakes.nopunc.gz" target="_blank">bible_shakespear</a> data set</li>
<li>Decompress and move to HDFS</li>
</ul>
<div class="codehilite"><pre><span></span>hdfs dfs -put bible_shakes.nopunc /user/&lt;your_user&gt;
</pre></div>

<ul>
<li>Download source code for <a href="../resources/wordcount.zip" target="_blank">word count example</a></li>
<li>Compile the code and create a jar (You can download this <a href="../resources/wordcount.jar" target="_blank">wordcount.jar</a> for testing)</li>
<li>To execute a MapReduce job:</li>
</ul>
<div class="codehilite"><pre><span></span>/bin/hadoop jar &lt;jar-name&gt; &lt;main-class&gt; &lt;input-path&gt; &lt;output-path&gt;
</pre></div>

<ul>
<li>Use the following command to run our example:</li>
</ul>
<div class="codehilite"><pre><span></span>/bin/hadoop jar wordcount.jar  exascale.info.lab.wordcount.WordCount /user/&lt;your_user&gt;/bible_shakes.nopunc /user/&lt;your_user&gt;/&lt;output_folder&gt;
</pre></div>

<ul>
<li>Monitor the job status and examine the logs:</li>
</ul>
<p><a href="https://hadoop-rm.daplab.ch/cluster" target="_blank">https://hadoop-rm.daplab.ch/cluster</a></p>
<ul>
<li>Examine the output in HDFS</li>
</ul>
<h2 id="implementation-tips">Implementation Tips</h2>
<ul>
<li>Input splits</li>
<li>Counters</li>
<li>Distributed cache</li>
<li>Number of mappers and reducers</li>
</ul>
<h2 id="bigrams-count">Bigrams count</h2>
<ul>
<li>Use the <a href="../resources/bible_shakes.nopunc.gz" target="_blank">bible_shakespear</a> data set again</li>
<li>Write a MapReduce program to count the co-occurrences of pairs of words</li>
<li>For simplicity, you can use this <a href="../resources/bigrams_Helper.zip" target="_blank">bigrams_Helper.zip</a> program structure and build upon it</li>
<li>Monitor the progress of your job</li>
<li>Examine the output</li>
<li>Use the combiner class to optimize your job</li>
</ul>
<details class="solution"><summary>Solution</summary><p>Mapper class:</p><ul><li>First we need to convert the Text value recieved by each map to String[]:
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">textToString</span><span class="o">(</span><span class="n">Text</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">();</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;[^a-z]+&quot;</span><span class="o">,</span> <span class="s">&quot; &quot;</span><span class="o">);</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&quot;^\\s+&quot;</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">);</span>
    <span class="n">StringTokenizer</span> <span class="n">itr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringTokenizer</span><span class="o">(</span><span class="n">text</span><span class="o">);</span>
    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">itr</span><span class="o">.</span><span class="na">hasMoreTokens</span><span class="o">())</span>
        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">itr</span><span class="o">.</span><span class="na">nextToken</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">toArray</span><span class="o">(),</span><span class="n">result</span><span class="o">.</span><span class="na">size</span><span class="o">(),</span><span class="n">String</span><span class="o">[].</span><span class="na">class</span><span class="o">);}</span>
</pre></div></li><li>Then we can loop over the String[] object and extract bigrams:
<div class="codehilite"><pre><span></span><span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Tokens</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">word</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">Tokens</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span>  <span class="n">Tokens</span><span class="o">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">]);</span>
    <span class="n">context</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">word</span><span class="o">,</span> <span class="n">one</span><span class="o">);}</span>
</pre></div></li></ul><p>Reducer class:</p><ul><li>We can use the same reducer as in the word count example, because we need to sum the values of the received keys (in this case the keys emitted by the mappers are bigrams):
<div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="k">for</span> <span class="o">(</span><span class="n">IntWritable</span> <span class="n">value</span> <span class="o">:</span> <span class="n">values</span><span class="o">)</span>
    <span class="n">sum</span> <span class="o">+=</span> <span class="n">value</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
<span class="n">result</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">sum</span><span class="o">);</span>
<span class="n">context</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
</pre></div></li></ul></details>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../hdfs/" title="HDFS" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                HDFS
              </span>
            </div>
          </a>
        
        
          <a href="../hive/" title="Hive" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Hive
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 DAPLAB & UNIFR
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-f3ab9e5ff8.js"></script>
      
      
      <script>app.initialize({url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
    
      
    
  </body>
</html>